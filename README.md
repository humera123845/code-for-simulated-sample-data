# code-for-simulated-sample-data
Application of Iterative Hybrid MI Approach to Household Survey Data with Complex Dependence Structures

# installing necessary packages
#install.packages("dplyr")
library(dplyr)
#install.packages("mice")
library(mice)
#install.packages("mitools")
library(mitools)
#install.packages("NPBayesImpute")
library(NPBayesImputeCat)
library(MASS)

#=========================================================================================================================
### 1. Step: 
# Simulating a dataset
# Design a covariance matrix
a <- .5
b <- .5
sig = matrix(c(1,a, a,  b,  b,   b, b,  b,  b,  b,  b, b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,  b,
               a,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               a,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,
               b,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1),
             nrow=31)

set.seed(100)
# Use the mvrnorm to draw a matrix of variables with 1000 objects
n <- 1000
out <- mvrnorm(1000, mu = c(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0), Sigma = sig, empirical = TRUE)

summary(out)
# check the covariances and correlation of variables
round(cov(out),1) 
round(cor(out),1)

# Now lets transform the variables
#X <- pnorm(out)
#summary(X)

#round(cov(X),1) # the covariances have dropped significantly, 
#round(cor(X),1) # the correlations are largely the same after transform

# Rename the data frame columns 
colnames(out) <- c("X1", "X2", "X3", "X4", "X5","X6", "X7", "X8", "X9", "X10","X11", "X12", "X13", "X14", "X15","X16", "X17", "X18", "X19", "X20","X21", "X22", "X23", "X24", "X25","X26", "X27", "X28", "X29", "X30","X31")

summary(out)

X_data <- as.data.frame(out) 
#par(mfrow=c(1,1))
#cor.ci(X_data , method="spearman")


head(X_data)
X1 <- ifelse(X_data$X1 > 0,1,0)
X2 <- ifelse(X_data$X2 > 0,1,0)
X3 <- ifelse(X_data$X3 > 0,1,0)
X4 <- ifelse(X_data$X4 > 0,1,0)
X5 <- ifelse(X_data$X5 >0,1,0)
X6 <- ifelse(X_data$X6 > 0,1,0)
X7 <- ifelse(X_data$X7 > 0,1,0)
X8 <- ifelse(X_data$X8 > 0,1,0)
X9 <- ifelse(X_data$X9 > 0,1,0)
X10 <- ifelse(X_data$X10 > 0,1,0)
X11 <- ifelse(X_data$X11 > 0,1,0)
X12 <- ifelse(X_data$X12 > 0,1,0)
X13 <- ifelse(X_data$X13 > 0,1,0)
X14 <- ifelse(X_data$X14 > 0,1,0)
X15 <- ifelse(X_data$X15 > 0,1,0)
X16 <- ifelse(X_data$X16 > 0,1,0)
X17 <- ifelse(X_data$X17 > 0,1,0)
X18 <- ifelse(X_data$X18 > 0,1,0)
X19 <- ifelse(X_data$X19 > 0,1,0)
X20 <- ifelse(X_data$X20 > 0,1,0)
X21 <- ifelse(X_data$X21 > 0,1,0)
X22 <- ifelse(X_data$X22 > 0,1,0)
X23 <- ifelse(X_data$X23 > 0,1,0)
X24 <- ifelse(X_data$X24 > 0,1,0)
X25 <- ifelse(X_data$X25 > 0,1,0)
X26 <- ifelse(X_data$X26 > 0,1,0)
X27 <- ifelse(X_data$X27 > 0,1,0)
X28 <- ifelse(X_data$X28 > 0,1,0)
X29 <- ifelse(X_data$X29 > 0,1,0)
X30<- ifelse(X_data$X30 > 0,1,0)
X31<- ifelse(X_data$X31 > 0,1,0)
#X32 <-1+1*X1+1*X2+1*X3+1*X4+1*X5+1*X6+1*X7+1*X8+1*X9+1*X10+1*X11+1*X12+1*X13+1*X14+1*X15+1*X16+1*X17+1*X18+1*X19+1*X20+1*X21+1*X22+1*X23+1*X24+1*X25+1*X26+1*X27+1*X28+1*X29+1*X30+1*X31+X1*X2*X3+X5*X8+X29*X2 
X32 <-0.1+0.1*X1+0.1*X2+0.1*X3+0.1*X4+0.1*X5+0.1*X6+0.1*X7+0.1*X8+0.1*X9+0.1*X10+0.1*X11+0.1*X12+0.1*X13+0.1*X14+0.1*X15+0.1*X16+0.1*X17+0.1*X18+0.1*X19+0.1*X20+0.1*X21+0.1*X22+0.1*X23+0.1*X24+0.1*X25+0.1*X26+0.1*X27+0.1*X28+0.1*X29+0.1*X30+0.1*X31+0.1*X2*X3+0.1*X5*X8+0.1*X29*X2 
X32 <-rnorm(1000,X32, sd=2^0.5)
range(X32)
#plot(X32)
#hist(X32)
#summary(X32)
X32cat <- cut(
  X32,
  
  breaks = c(    -4,  -0.04,  1,1.9, 2.5,4,9),
  labels = c("1", "2", "3", "4", "5", "6"),
  right  = FALSE
  
)
table(X32cat)
X33 <-1.1+1.1*X1+1.1*X2+1.1*X3+1.1*X4+1.1*X5+1.1*X6+1.1*X7+1.1*X8+1.1*X9+1.1*X10+1.1*X11+0.1*X12+0.1*X13+0.1*X14+1.1*X15+1.1*X16+1.1*X17+1.1*X18+1.1*X19+0.1*X20+0.1*X21+0.1*X22+0.1*X23+0.1*X24+0.1*X25+0.1*X26+0.1*X27+0.1*X28+0.1*X29+0.1*X30+0.1*X31+0.1*X32+0.1*X2*X3+0.1*X5*X8+0.1*X29*X2 

#X33 <-0.1+0.1*X1+0.1*X2+0.1*X3+0.1*X4+0.1*X5+0.1*X6+0.1*X7+0.1*X8+0.1*X9+0.1*X10+0.1*X11+0.1*X12+0.1*X13+0.1*X14+0.1*X15+0.1*X16+0.1*X17+0.1*X18+0.1*X19+0.1*X20+0.1*X21+0.1*X22+0.1*X23+0.1*X24+0.1*X25+0.1*X26+0.1*X27+0.1*X28+0.1*X29+0.1*X30+0.1*X31+0.1*X32+0.1*X2*X3+0.1*X5*X8+0.1*X29*X2 
X33 <-rnorm(1000,X33, sd=2^0.5)
range(X33)
X33cat <- cut(
  X33,
  breaks = c(-6,5,10,15,25),
  labels = c("1", "2", "3", "4"), right  = FALSE
)
summary(X33)


table(X33cat)
#h =-2-1.5*X1+2.15*X2+2.25*X3-3.6*X4-1.88*X5+1.11*X6+2*X7-5*X8+1*X9-2*X10+2*X11+5*X12-2*X13+3*X14+4*X15+1*X16+1*X17-1*X18-1*X19-1*X20-1*X21-1*X22-2*X23-1*X24+1*X25+1*X26+1*X27+1*X28+1*X29+1*X30+X31+2*X32-1*X33+2*X11*X12*X13-2*X15*X18+2*X29*X12
#h =-1+0.0065*X1+0.15*X2+0.25*X3+0.6*X4+0.88*X5+0.11*X6+0.2*X7+0.5*X8+0.1*X9+0.2*X10+0.2*X11+0.5*X12-0.2*X13+0.3*X14+0.4*X15+0.1*X16+0.1*X17-0.1*X18-0.1*X19-0.1*X20-0.*X21-0.1*X22-0.2*X23-0.1*X24+0.1*X25+0.1*X26+0.1*X27+0.1*X28+1*X29+1*X30+X31+0.2*X32+1*X33+0.2*X11*X12*X13-X15*X18+0.2*X29*X1
#h =8.5-2.5*X1-1.5*X2-2.5*X3-2.5*X4+2.5*X5+1.8*X6+1.2*X7+1.2*X8+2.1*X9+2.1*X10-2*X11+1*X12-X13+2*X14-1*X15+2.2*X16-1.3*X17-1.2*X18-1.7*X19+1.8*X20+1.8*X21+1*X22+1.9*X23+1*X24+1*X25-1*X26+1*X27+1.8*X28+1.8*X29-1.1*X30+X31+0.9*X32-0.9*X33-2*X15*X18-1*X29*X11+2*X1*X29*X30
#h =0.001-0.9*X1-0.9*X2-0.9*X3-0.9*X4+0.5*X5+0.8*X6-0.2*X7+0.2*X8+0.1*X9+0.1*X10-0.2*X11+0.1*X12-X13+0.2*X14-1*X15+0.2*X16-0.3*X17-0.2*X18-0.7*X19+0.8*X20+0.8*X21+0.1*X22+0.9*X23+0.9*X24+0.9*X25-0.1*X26+0.1*X27+0.8*X28+0.8*X29-0.1*X30+0.9*X31+0.2*X29*X12-2*X15*X18
#h =0.001-0.9*X1-0.9*X2-0.9*X3-0.9*X4+0.5*X5+0.8*X6-0.2*X7+0.2*X8+0.1*X9+0.1*X10-0.2*X11+0.1*X12-X13+0.2*X14-1*X15+0.2*X16-0.3*X17-0.2*X18-0.7*X19+0.8*X20+0.8*X21+0.1*X22+0.9*X23+0.9*X24+0.9*X25-0.1*X26+0.1*X27+0.8*X28+0.8*X29-0.1*X30+0.9*X31+0.2*X29*X12-2*X15*X18
h =0.001-0.01*X1-0.09*X2-0.09*X3-0.09*X4+0.05*X5+0.08*X6-0.02*X7+0.02*X8+0.01*X9+0.01*X10-0.02*X11+0.01*X12-X13+0.02*X14-0.01*X15+0.02*X16-0.03*X17-0.02*X18-0.07*X19+0.08*X20+0.08*X21+0.01*X22+0.09*X23+0.09*X24+0.09*X25-0.01*X26+0.01*X27+0.08*X28+0.08*X29-0.01*X30+0.09*X31+0.02*X29*X12-0.02*X15*X18*X29
pr = exp(h)/(1+exp(h))
range(pr)
X34 = rbinom(1000,1,pr)                           
table(X34)


X35 =0.002+0.5*X1-0.15*X2+0.25*X3-0.6*X4-0.88*X5+0.11*X6+0.2*X7-0.5*X8+0.1*X9-0.2*X10+0.3*X11+5*X12-0.2*X13+0.3*X14+0.4*X15+0.1*X16+0.1*X17-0.1*X18-0.1*X19-0.1*X20-0.1*X21-0.1*X22-0.2*X23-0.1*X24+1*X25+1*X26+0.1*X27+0.1*X28+0.1*X29+0.1*X30+0.1*X31+0.2*X32-0.1*X33+0.5*X34+0.2*X11*X12*X13-0.2*X15*X18+0.2*X29*X12
X35 <-rnorm(1000,X35, sd=2^0.5)


X38 =3-0.5*X1-0.2*X2+0.05*X3-0.6*X4-0.08*X5+0.01*X6+0.2*X7+0.2*X8+0.1*X9-0.1*X10+0.2*X11+0.5*X12-0.2*X13+0.3*X14+0.4*X15+0.1*X16+0.1*X17-0.1*X18-0.1*X19-0.1*X20-0.1*X21-0.1*X22-0.2*X23-0.1*X24+0.1*X25+0.1*X26+0.1*X27+0.1*X28+0.1*X29+0.1*X30+X31+0.2*X32-0.1*X33+X34+X35+0.2*X11*X12*X13-0.2*X15*X18+0.2*X29*X12
X38 <-rnorm(1000,X38, sd=2^0.5)

X_data<-cbind(X1,X2,X3,X4,X5,X6,X7,X8,X9,X10,X11,X12,X13,X14,X15,X16,X17,X18,X19,X20,X21,X22,
              X23,X24,X25,X26,X27,X28,X29,X30,X31,X32cat,X33cat,X34,X35,X38)

X_data<-as.data.frame(X_data)
###############################################
